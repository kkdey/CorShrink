diag(1, dim)
dim <- 100
nsamples <- 5
pop_cov <- generate_cov(dim);
plot(sort(pop_cov$eigen, decreasing = TRUE), type="l")
library(CorShrink)
dim <- 100
nsamples <- 5
pop_cov <- generate_cov(dim);
plot(sort(pop_cov$eigen, decreasing = TRUE), type="l")
block1 <- diag(1, dim)
block1
block1 <- diag(1, dim) + rho1*rep(1, dim)%*% t(rep(1, dim))
rho1 <- 0.3;
block1 <- diag(rho1, dim) + (1-rho1)*rep(1, dim)%*% t(rep(1, dim))
block1
rho1 <- 0.7;
block1 <- diag(rho1, dim) + (1-rho1)*rep(1, dim)%*% t(rep(1, dim))
rho1 <- 0.7;
rho2 <- 0.5;
block1 <- diag(rho1, dim) + (1-rho1)*rep(1, dim)%*% t(rep(1, dim))
block2 <- diag(rho2, dim) + (1-rho2)*rep(1, dim)%*% t(rep(1, dim))
rho1 <- 0.7;
rho2 <- 0.5;
block1 <- diag(rho1, dim/2) + (1-rho1)*rep(1, dim/2)%*% t(rep(1, dim/2))
block2 <- diag(rho2, dim/2) + (1-rho2)*rep(1, dim/2)%*% t(rep(1, dim/2))
pop_cov <- rbind(block1, block2);
dim(pop_cov)
pop_cov <- bdiag(block1, block2);
install.packages("Matrix")
library(devtools)
read.data1 = function() {
x = tempfile()
download.file('https://cdn.rawgit.com/kkdey/singleCellRNASeqMouseDeng2014/master/data/Deng2014MouseEsc.rda', destfile=x, quiet=TRUE)
z = get(load((x)))
return(z)
}
Deng2014MouseESC <- read.data1()
deng.counts <- Biobase::exprs(Deng2014MouseESC)
deng.meta_data <- Biobase::pData(Deng2014MouseESC)
deng.gene_names <- rownames(deng.counts)
voom_deng_counts <- limma::voom(deng.counts)$E
dat <- t(voom_deng_counts)
covshrink_ML <- CorShrink::CovShrink(voom_deng_counts, 6, type="ML");
color=c("blue","cornflowerblue","black","cyan","darkblue",
"brown4","burlywood","darkgoldenrod1","darkgray","deepskyblue","darkkhaki",
"firebrick","darkorchid","red","green","magenta", "azure1","azure4");
color1 <- rev(color)
cov_sample <- cov(voom_deng_counts)
par(mfrow=c(1,2))
library(expm)
projected_dat <- sqrtm(covshrink_ML)%*% sqrtm(solve(cov_sample)) %*% dat
pr_projected <- prcomp(projected_dat)
plot(pr_projected$x[,1], pr_projected$x[,2], col=color1[factor(deng.meta_data$cell_type)],
pch=20, cex=1)
pr <- prcomp(dat);
plot(pr$x[,1], pr$x[,2], col=color1[factor(deng.meta_data$cell_type)],
pch=20, cex=1)
setwd("~/Documents/CorShrink/vignettes/test")
covshrink_ML <- get(load("../ShrinkCovpaper/covshrink_deng_tf.rda"))
which(corshrink_ML > 0.8, arr.ind = TRUE)
corshrink_ML <- cov2cor(covshrink_ML)
which(corshrink_ML > 0.8, arr.ind = TRUE)
corshrink_ML <- cov2cor(as.matrix(covshrink_ML))
which(corshrink_ML > 0.8, arr.ind = TRUE)
corshrink_ML > 0.8
dim(which(corshrink_ML > 0.8, arr.ind = TRUE))
dim(which(corshrink_ML > 0.9, arr.ind = TRUE))
which(corshrink_ML > 0.9, arr.ind = TRUE)
unique(which(corshrink_ML > 0.9, arr.ind = TRUE)[,1])
which(corshrink_ML > 0.9, arr.ind = TRUE)[,1]
unique(which(corshrink_ML > 0.9, arr.ind = TRUE)[,1])
which(corshrink_ML > 0.9, arr.ind = TRUE)
corshrink_ML
which(corshrink_ML > 0.9)
corshrink_ML[1,]
max(corshrink_ML[1,])
indices <- which(corshrink_ML > 0.9 && corshrink_ML < 1, arr.ind = TRUE)
indices
indices <- which(corshrink_ML > 0.9 & corshrink_ML < 1, arr.ind = TRUE)
indices
indices[,2]
unique(indices[,2])
deng_tf_data <- get(load("../ShrinkCovpaper/deng_counts_tf.rda"))
deng_tf_data[1:5,]
rownames(deng_tf_data)[unique(indices[,2])]
write.table(rownames(deng_tf_data)[unique(indices[,2])], "../high_cor_genes_deng_tf.txt", col.names = FALSE, row.names=FALSE, quote=FALSE);
write.table(rownames(deng_tf_data), "../all_genes_deng_tf.txt", col.names = FALSE, row.names=FALSE, quote=FALSE);
index <- grep("Pou1f1", rownames(deng_tf_data))
plot(1:dim(deng_tf_data)[2], log(deng_tf_data[index,]+1), type="l", col="red",  ylab="log expr.", main=" Pou1f1 expression", xaxt="n", xlab="")
read.data1 = function() {
x = tempfile()
download.file('https://cdn.rawgit.com/kkdey/singleCellRNASeqMouseDeng2014/master/data/Deng2014MouseEsc.rda', destfile=x, quiet=TRUE)
z = get(load((x)))
return(z)
}
Deng2014MouseESC <- read.data1()
cell_meta <- deng.meta_data <- Biobase::pData(Deng2014MouseESC)
cell_meta
deng.meta_data <- Biobase::pData(Deng2014MouseESC)
cell_meta <- deng.meta_data$cell_type
labels = match(unique(cell_meta), cell_meta);
abline(v=labels)
labels_low=labels;
labels_up=c(labels[2:length(labels)],dim(reads)[2]);
mid_point=labels_low +0.5*(labels_up-labels_low);
axis(1,at=mid_point, unique(cell_meta),las=3, cex.axis=0.8);
deng.meta_data <- Biobase::pData(Deng2014MouseESC)
cell_meta <- deng.meta_data$cell_type
index <- grep("Pou1f1", rownames(deng_tf_data))
plot(1:dim(deng_tf_data)[2], log(deng_tf_data[index,]+1), type="l", col="red",  ylab="log expr.", main=" Pou1f1 expression", xaxt="n", xlab="")
labels = match(unique(cell_meta), cell_meta);
abline(v=labels)
labels_low=labels;
labels_up=c(labels[2:length(labels)],dim(deng_tf_data)[2]);
mid_point=labels_low +0.5*(labels_up-labels_low);
axis(1,at=mid_point, unique(cell_meta),las=3, cex.axis=0.8);
cell_meta <- deng.meta_data$cell_type
index <- grep("Rhox2a", rownames(deng_tf_data))
plot(1:dim(deng_tf_data)[2], log(deng_tf_data[index,]+1), type="l", col="red",  ylab="log expr.", main=" Rhox2a expression", xaxt="n", xlab="")
labels = match(unique(cell_meta), cell_meta);
abline(v=labels)
labels_low=labels;
labels_up=c(labels[2:length(labels)],dim(deng_tf_data)[2]);
mid_point=labels_low +0.5*(labels_up-labels_low);
axis(1,at=mid_point, unique(cell_meta),las=3, cex.axis=0.8);
cell_meta <- deng.meta_data$cell_type
index <- grep("Rhox4g", rownames(deng_tf_data))
plot(1:dim(deng_tf_data)[2], log(deng_tf_data[index,]+1), type="l", col="red",  ylab="log expr.", main=" Rhox4g expression", xaxt="n", xlab="")
labels = match(unique(cell_meta), cell_meta);
abline(v=labels)
labels_low=labels;
labels_up=c(labels[2:length(labels)],dim(deng_tf_data)[2]);
mid_point=labels_low +0.5*(labels_up-labels_low);
axis(1,at=mid_point, unique(cell_meta),las=3, cex.axis=0.8);
