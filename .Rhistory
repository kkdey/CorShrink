col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index, features[k,num]],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=2,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
k <- 4
num <- 6
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index, features[k,num]],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=2,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
k <- 4
num <- 7
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index, features[k,num]],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=2,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
k <- 4
num <- 8
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index, features[k,num]],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=2,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
k <- 4
num <- 9
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index, features[k,num]],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=2,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
k <- 8
num <- 9
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index, features[k,num]],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=2,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
abs_effect <- exp(flash_out$f)
normalized_abs_effect <- apply(abs_effect, 2, function(x) return (x/sum(x)))
features <- CountClust::ExtractTopFeatures(normalized_abs_effect, top_features = 10, method = "poisson", options = "min")
k <- 8
num <-
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
k <- 8
num <- 3
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index, features[k,num]],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=2,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
k <- 8
num <- 5
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index, features[k,num]],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=2,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
k <- 8
num <- 6
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index, features[k,num]],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=2,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
k <- 4
num <- 6
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index, features[k,num]],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=2,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
k <- 3
num <- 6
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index, features[k,num]],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=2,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
k <- 3
num <- 6
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index, features[k,num]],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=2,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
dim(flash_out$l)
dim(flash_out$f)
projected_flash_data <- (flash_out$l)%*%t(flash_out$f)
dim(projected_flash_data)
projected_flash_data[1:5,1:5,1]
projected_flash_data <- (flash_out$l)%*%t(flash_out$f)
inv_projected_flash_data <- (exp(2*projected_flash_data)-1)/(exp(2*projected_flash_data)+1)
dim(inv_projected_flash_data)
projected_data <- array(0, c(dim(data)[1], dim(data)[2], dim(data)[3]));
for(ll in 1:dim(data)[3]){
mat2 <- matrix(0, dim(data)[1], dim(data)[2])
mat2[lower.tri(mat2)] <- inv_projected_flash_data[,ll]
diag(mat2) <- 1
projected_data[,,ll] <- (mat2 + t(mat2))
}
dim(projected_data)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index,1],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=2,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(projected_data[order_index, order_index,1],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=2,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
par(mfrow=c(2,1))
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index,1],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=2,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(projected_data[order_index, order_index,1],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=2,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
par(mfrow=c(1,2))
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index,1],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=2,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(projected_data[order_index, order_index,1],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=2,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
projected_data <- array(0, c(dim(data)[1], dim(data)[2], dim(data)[3]));
for(ll in 1:dim(data)[3]){
mat2 <- matrix(0, dim(data)[1], dim(data)[2])
mat2[lower.tri(mat2)] <- inv_projected_flash_data[,ll]
projected_data[,,ll] <- (mat2 + t(mat2))
diag(mat2) <- 1
}
par(mfrow=c(1,2))
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index,1],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=2,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(projected_data[order_index, order_index,1],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=2,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
par(mfrow=c(1,2))
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index,1],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=2,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(projected_data[order_index, order_index,1],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
par(mfrow=c(1,2))
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index,1],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(projected_data[order_index, order_index,1],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
par(mfrow=c(1,2))
num <- grep("ENSG00000244734", gene_names_1)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index,1],
col=col, main=paste0("corr structure: ", gene_names_1[num]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(projected_data[order_index, order_index,1],
col=col, main=paste0("corr structure: ", gene_names_1[num]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
par(mfrow=c(1,2))
num <- grep("ENSG00000244734", gene_names_1)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index,num],
col=col, main=paste0("corr structure: ", gene_names_1[num]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(projected_data[order_index, order_index,num],
col=col, main=paste0("corr structure: ", gene_names_1[num]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
data
which(data == 0)
par(mfrow=c(1,2))
num <- grep("ENSG00000171401", gene_names_1)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index,num],
col=col, main=paste0("corr structure: ", gene_names_1[num]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(projected_data[order_index, order_index,num],
col=col, main=paste0("corr structure: ", gene_names_1[num]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
par(mfrow=c(1,2))
num <- grep("ENSG00000170477", gene_names_1)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index,num],
col=col, main=paste0("corr structure: ", gene_names_1[num]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(projected_data[order_index, order_index,num],
col=col, main=paste0("corr structure: ", gene_names_1[num]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
projected_data <- array(0, c(dim(data)[1], dim(data)[2], dim(data)[3]));
for(ll in 1:dim(data)[3]){
mat2 <- matrix(0, dim(data)[1], dim(data)[2])
mat2[lower.tri(mat2)] <- inv_projected_flash_data[,ll]
projected_data[,,ll] <- (mat2 + t(mat2))
diag(projected_data[,,ll]) <- 1
}
par(mfrow=c(1,2))
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index,1],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
par(mfrow=c(1,2))
num <- grep("ENSG00000244734", gene_names_1)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index,num],
col=col, main=paste0("corr structure: ", gene_names_1[num]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(projected_data[order_index, order_index,num],
col=col, main=paste0("corr structure: ", gene_names_1[num]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
par(mfrow=c(1,2))
num <- grep("ENSG00000244734", gene_names_1)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index,num],
col=col, main=paste0("corr structure: ", gene_names_1[num]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(projected_data[order_index, order_index,num],
col=col, main=paste0("corr structure: ", gene_names_1[num]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
par(mfrow=c(1,2))
num <- grep("ENSG00000171401", gene_names_1)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index,num],
col=col, main=paste0("corr structure: ", gene_names_1[num]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(projected_data[order_index, order_index,num],
col=col, main=paste0("corr structure: ", gene_names_1[num]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
par(mfrow=c(1,2))
num <- grep("ENSG00000133392", gene_names_1)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index,num],
col=col, main=paste0("corr structure: ", gene_names_1[num]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(projected_data[order_index, order_index,num],
col=col, main=paste0("corr structure: ", gene_names_1[num]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
flash_out <-  get(load("../rdas/backfit_flash_output_corshrink_15.rda"))
corr_mat_vectors_facs <- flash_out$l
corr_mat_vectors_facs_trans <- (exp(2*corr_mat_vectors_facs)-1)/(exp(2*corr_mat_vectors_facs)+1)
corr_mat_fac <- array(0, c(dim(data)[1], dim(data)[2], 20));
for(k in 1:dim(corr_mat_vectors_facs)[2]){
mat2 <- matrix(0, dim(data)[1], dim(data)[2])
mat2[lower.tri(mat2)] <- corr_mat_vectors_facs_trans[,k]
diag(mat2) <- 1
corr_mat_fac[,,k] <- (mat2 + t(mat2))
}
for(num in 1:dim(corr_mat_vectors_facs)[2]){
temp_mat <- as.matrix(corr_mat_fac[order_index,order_index, num])
min_temp <- quantile(temp_mat[lower.tri(temp_mat)], 0.1)
max_temp <- quantile(temp_mat[lower.tri(temp_mat)], 0.9)
temp_mat[temp_mat > max_temp] = max_temp
temp_mat[temp_mat < min_temp] = min_temp
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(temp_mat,
col=col, main=paste0("corr structure factor: ", num), cex.main=2,
xaxt = "n", yaxt = "n", zlim=c(min_temp,max_temp))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
}
abs_effect <- exp(flash_out$f)
normalized_abs_effect <- apply(abs_effect, 2, function(x) return (x/sum(x)))
features <- CountClust::ExtractTopFeatures(normalized_abs_effect, top_features = 10, method = "poisson", options = "min")
k <- 4
num <- 6
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index, features[k,num]],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=2,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
k <- 4
num <- 1
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index, features[k,num]],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=2,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
k <- 4
num <- 2
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index, features[k,num]],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=2,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
k <- 4
num <- 3
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index, features[k,num]],
col=col, main=paste0("corr structure: ", gene_names_1[features[k,num]]), cex.main=2,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
projected_flash_data <- (flash_out$l)%*%t(flash_out$f)
inv_projected_flash_data <- (exp(2*projected_flash_data)-1)/(exp(2*projected_flash_data)+1)
projected_data <- array(0, c(dim(data)[1], dim(data)[2], dim(data)[3]));
for(ll in 1:dim(data)[3]){
mat2 <- matrix(0, dim(data)[1], dim(data)[2])
mat2[lower.tri(mat2)] <- inv_projected_flash_data[,ll]
projected_data[,,ll] <- (mat2 + t(mat2))
diag(projected_data[,,ll]) <- 1
}
par(mfrow=c(1,2))
num <- grep("ENSG00000244734", gene_names_1)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index,num],
col=col, main=paste0("corr structure: ", gene_names_1[num]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(projected_data[order_index, order_index,num],
col=col, main=paste0("corr structure: ", gene_names_1[num]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
par(mfrow=c(1,2))
num <- grep("ENSG00000171401", gene_names_1)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index,num],
col=col, main=paste0("corr structure: ", gene_names_1[num]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(projected_data[order_index, order_index,num],
col=col, main=paste0("corr structure: ", gene_names_1[num]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
par(mfrow=c(1,2))
num <- grep("ENSG00000170477", gene_names_1)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index,num],
col=col, main=paste0("corr structure: ", gene_names_1[num]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(projected_data[order_index, order_index,num],
col=col, main=paste0("corr structure: ", gene_names_1[num]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
par(mfrow=c(1,2))
num <- grep("ENSG00000133392", gene_names_1)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(data[order_index, order_index,num],
col=col, main=paste0("corr structure: ", gene_names_1[num]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
col=c(rev(rgb(seq(1,0,length=1000),1,seq(1,0,length=1000))),
rgb(1,seq(1,0,length=1000),seq(1,0,length=1000)))
image(projected_data[order_index, order_index,num],
col=col, main=paste0("corr structure: ", gene_names_1[num]), cex.main=0.7,
xaxt = "n", yaxt = "n", zlim=c(-1,+1))
axis(1, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
axis(2, at = seq(0, 1, length.out = 53), labels = unique_tissues[order_index], las=2, cex.axis = 0.5)
devtools::document()
library(CorShrink)
devtools::document()
devtools::document()
library(CorShrink)
source('~/Documents/CorShrink/R/CorShrinkML.R')
devtools::document()
library(CorShrink)
